var data = [{ "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "1e52e2abba9aadfa7ffc249c53a14e5f00ffb58f", "fields": { "ebike": 2, "capacity": 21, "name": "Toudouze - Clauzel", "nom_arrondissement_communes": "Paris", "numbikesavailable": 2, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 0, "stationcode": "9020", "coordonnees_geo": [48.8792959173, 2.33736008406], "numdocksavailable": 19, "duedate": "2020-11-03T14:44:09+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.33736008406, 48.8792959173] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "547a2f9e013274dc2a1f0abd0967d6de9c6e323f", "fields": { "ebike": 0, "capacity": 17, "name": "Thouin - Cardinal Lemoine", "nom_arrondissement_communes": "Paris", "numbikesavailable": 0, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 0, "stationcode": "5016", "coordonnees_geo": [48.8450471666, 2.34946478513], "numdocksavailable": 16, "duedate": "2020-11-03T14:40:33+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.34946478513, 48.8450471666] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "1d5af081c5fe661567e9425dd792eb5972b07745", "fields": { "ebike": 1, "capacity": 30, "name": "De Toqueville - Terrasse", "nom_arrondissement_communes": "Paris", "numbikesavailable": 2, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 1, "stationcode": "17048", "coordonnees_geo": [48.882428, 2.314002], "numdocksavailable": 28, "duedate": "2020-11-03T14:48:22+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.314002, 48.882428] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "3845434bcaafb7e0bdfc52e3bb0fdabbba379cfd", "fields": { "ebike": 0, "capacity": 30, "name": "Saint-Cloud - Hippodrome", "nom_arrondissement_communes": "Paris", "numbikesavailable": 1, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 1, "stationcode": "16138", "coordonnees_geo": [48.8577214889, 2.2549109906], "numdocksavailable": 29, "duedate": "2020-11-03T14:48:51+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.2549109906, 48.8577214889] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "a088841f906fe815c1b4ebee5aed9d114a3175bf", "fields": { "ebike": 1, "capacity": 22, "name": "Rond-point du Dr Albert Schweitzer", "nom_arrondissement_communes": "Bagneux", "numbikesavailable": 1, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 0, "stationcode": "22207", "coordonnees_geo": [48.7898091899, 2.31439400464], "numdocksavailable": 20, "duedate": "2020-11-03T14:49:13+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.31439400464, 48.7898091899] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "cd422ecf1a66e2cf85a37a845b2f3f82bdba6c77", "fields": { "ebike": 1, "capacity": 17, "name": "Tour d'Auvergne - Rodier", "nom_arrondissement_communes": "Paris", "numbikesavailable": 2, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 1, "stationcode": "9008", "coordonnees_geo": [48.879161, 2.343698], "numdocksavailable": 15, "duedate": "2020-11-03T14:44:42+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.343698, 48.879161] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "afa191c4116e73cc9c2cea6c620d88a2c87f6477", "fields": { "ebike": 0, "capacity": 21, "name": "Octave Feuillet - Albéric Magnard", "nom_arrondissement_communes": "Paris", "numbikesavailable": 1, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 1, "stationcode": "16110", "coordonnees_geo": [48.8610690295, 2.27302830666], "numdocksavailable": 20, "duedate": "2020-11-03T14:46:47+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.27302830666, 48.8610690295] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "4669322276783deaea5d2d641c31c5de1b94937a", "fields": { "ebike": 0, "capacity": 21, "name": "Jean Oestreicher - Porte de Champerret", "nom_arrondissement_communes": "Paris", "numbikesavailable": 1, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 1, "stationcode": "17032", "coordonnees_geo": [48.8865558007, 2.28864043951], "numdocksavailable": 20, "duedate": "2020-11-03T14:44:42+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.28864043951, 48.8865558007] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "af1f7f97de261bfe25aa6fa8810aca7a8fe56d2f", "fields": { "ebike": 3, "capacity": 24, "name": "Mairie du 17ème", "nom_arrondissement_communes": "Paris", "numbikesavailable": 3, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 0, "stationcode": "17012", "coordonnees_geo": [48.8841618487, 2.3220794311], "numdocksavailable": 21, "duedate": "2020-11-03T14:48:09+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.3220794311, 48.8841618487] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "66ab1152757583414383178d9d5f2fb1506ce2d6", "fields": { "ebike": 2, "capacity": 24, "name": "Quai de la Seine", "nom_arrondissement_communes": "Paris", "numbikesavailable": 3, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 1, "stationcode": "19003", "coordonnees_geo": [48.8844922384, 2.37039417028], "numdocksavailable": 21, "duedate": "2020-11-03T14:48:55+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.37039417028, 48.8844922384] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "8c1a0aee9c24724383b475babd1e4b71d80a0221", "fields": { "ebike": 1, "capacity": 17, "name": "Place de Rhin et Danube", "nom_arrondissement_communes": "Paris", "numbikesavailable": 1, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 0, "stationcode": "19026", "coordonnees_geo": [48.8819276586, 2.39258676767], "numdocksavailable": 16, "duedate": "2020-11-03T14:49:43+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.39258676767, 48.8819276586] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "b4415173c2552158bceda931a7278ad52c2c41c8", "fields": { "ebike": 2, "capacity": 26, "name": "Place Du Général De Gaulle", "nom_arrondissement_communes": "Montreuil", "numbikesavailable": 2, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 0, "stationcode": "31009", "coordonnees_geo": [48.8687591, 2.4329931], "numdocksavailable": 24, "duedate": "2020-11-03T14:48:19+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.4329931, 48.8687591] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "6d53fca3c7788dd3695856f4861831045706a0c7", "fields": { "ebike": 1, "capacity": 17, "name": "Récollets - Square Villemin", "nom_arrondissement_communes": "Paris", "numbikesavailable": 3, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 2, "stationcode": "10016", "coordonnees_geo": [48.8750346559, 2.3598012386], "numdocksavailable": 14, "duedate": "2020-11-03T14:49:38+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.3598012386, 48.8750346559] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "a873c5b9f856d6f9f4161b2e55913a26750e04dd", "fields": { "ebike": 1, "capacity": 24, "name": "Square Simon Bolivar", "nom_arrondissement_communes": "Paris", "numbikesavailable": 1, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 0, "stationcode": "19101", "coordonnees_geo": [48.8750898883, 2.38263040781], "numdocksavailable": 22, "duedate": "2020-11-03T14:42:11+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.38263040781, 48.8750898883] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "19f6f5fb66b24c7b1975dcc90dd0558634bf6a5b", "fields": { "ebike": 1, "capacity": 24, "name": "Gambetta - Saint Fargeau", "nom_arrondissement_communes": "Paris", "numbikesavailable": 2, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 1, "stationcode": "20037", "coordonnees_geo": [48.8712446104, 2.40390568972], "numdocksavailable": 22, "duedate": "2020-11-03T14:49:24+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.40390568972, 48.8712446104] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "7dfecb7fabf71a9b5ee2530112a50687444beb06", "fields": { "ebike": 2, "capacity": 27, "name": "Carducci - Place Hannah Arendt", "nom_arrondissement_communes": "Paris", "numbikesavailable": 2, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 0, "stationcode": "19120", "coordonnees_geo": [48.8774366815, 2.38607436419], "numdocksavailable": 25, "duedate": "2020-11-03T14:47:36+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.38607436419, 48.8774366815] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "a3ffa8791fd29c5fc6cf76c3f9f06bf0df5410f8", "fields": { "ebike": 2, "capacity": 32, "name": "Porte de Vanves", "nom_arrondissement_communes": "Paris", "numbikesavailable": 3, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 1, "stationcode": "14138", "coordonnees_geo": [48.8280128494, 2.30568788946], "numdocksavailable": 29, "duedate": "2020-11-03T14:47:58+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.30568788946, 48.8280128494] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "59fbcfaee29bbafc23d27380fdd512e3ac6c4742", "fields": { "ebike": 1, "capacity": 25, "name": "Conservatoire de Musique", "nom_arrondissement_communes": "Choisy-le-Roi", "numbikesavailable": 3, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 2, "stationcode": "46003", "coordonnees_geo": [48.7709358667, 2.40340143442], "numdocksavailable": 22, "duedate": "2020-11-03T14:47:56+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.40340143442, 48.7709358667] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "855f4a7205f455761fb7961cfa0c07e316ab4818", "fields": { "ebike": 1, "capacity": 33, "name": "Repos - Cimetière du Père Lachaise", "nom_arrondissement_communes": "Paris", "numbikesavailable": 1, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 0, "stationcode": "20131", "coordonnees_geo": [48.8593585236, 2.38961313668], "numdocksavailable": 32, "duedate": "2020-11-03T14:47:51+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.38961313668, 48.8593585236] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "fbc756b977b70cb1be6a906c4d8f106f2615b330", "fields": { "ebike": 0, "capacity": 20, "name": "Marcelle - Thalie", "nom_arrondissement_communes": "Pantin", "numbikesavailable": 0, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 0, "stationcode": "35020", "coordonnees_geo": [48.8835462, 2.4137883], "numdocksavailable": 20, "duedate": "2020-11-03T14:44:35+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.4137883, 48.8835462] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "465e5c677b1b74051f3bed1605bf649952741377", "fields": { "ebike": 2, "capacity": 20, "name": "Botzaris - Parc des Buttes Chaumont", "nom_arrondissement_communes": "Paris", "numbikesavailable": 3, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 1, "stationcode": "19024", "coordonnees_geo": [48.877951, 2.381464], "numdocksavailable": 17, "duedate": "2020-11-03T14:49:42+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.381464, 48.877951] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "7c7c50c3619e8c8c11a9f8a0e5a94a0275b53b3e", "fields": { "ebike": 1, "capacity": 22, "name": "Aristide Briand - Gare de Bagneux", "nom_arrondissement_communes": "Cachan", "numbikesavailable": 3, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 2, "stationcode": "42302", "coordonnees_geo": [48.7938726966, 2.32114881277], "numdocksavailable": 19, "duedate": "2020-11-03T14:45:25+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.32114881277, 48.7938726966] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "517f8e281ca6c3153c69adcc47c73f0ffef33e5c", "fields": { "ebike": 1, "capacity": 32, "name": "Hautpoul - Jean Jaurès", "nom_arrondissement_communes": "Paris", "numbikesavailable": 2, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 1, "stationcode": "19016", "coordonnees_geo": [48.8863936794, 2.38654145444], "numdocksavailable": 27, "duedate": "2020-11-03T14:49:08+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.38654145444, 48.8863936794] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "9612b4875a2d82817f85c4f5c1d99d53aa4f08b9", "fields": { "ebike": 1, "capacity": 30, "name": "Gare RER de Gentilly", "nom_arrondissement_communes": "Gentilly", "numbikesavailable": 1, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 0, "stationcode": "42504", "coordonnees_geo": [48.8142804504, 2.34103471041], "numdocksavailable": 29, "duedate": "2020-11-03T14:42:06+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.34103471041, 48.8142804504] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "3674fab32e3597fb9743f0635e52a5ee0a22710d", "fields": { "ebike": 0, "capacity": 0, "name": "Clichy - Lechapelais", "nom_arrondissement_communes": "Paris", "numbikesavailable": 0, "is_installed": "NON", "is_renting": "NON", "mechanical": 0, "stationcode": "17123", "coordonnees_geo": [48.8993920671, 2.33194202185], "numdocksavailable": 0, "duedate": "2019-10-10T08:58:39+00:00", "is_returning": "NON" }, "geometry": { "type": "Point", "coordinates": [2.33194202185, 48.8993920671] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "473ca5b904323484c5afdb9a85c40af4fe2cceab", "fields": { "ebike": 1, "capacity": 25, "name": "Aristide Briand - Place de la Résistance", "nom_arrondissement_communes": "Issy-les-Moulineaux", "numbikesavailable": 1, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 0, "stationcode": "21302", "coordonnees_geo": [48.821242484, 2.25110024214], "numdocksavailable": 23, "duedate": "2020-11-03T14:44:42+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.25110024214, 48.821242484] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "b6d063817c8abb95e53e7e447c799ed27d05928d", "fields": { "ebike": 2, "capacity": 26, "name": "Flandre - Alphonse Karr", "nom_arrondissement_communes": "Paris", "numbikesavailable": 3, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 1, "stationcode": "19008", "coordonnees_geo": [48.89465, 2.381868], "numdocksavailable": 23, "duedate": "2020-11-03T14:45:08+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.381868, 48.89465] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }, { "datasetid": "velib-disponibilite-en-temps-reel", "recordid": "6fee6aac0a9fa2234664e8d0ea343985a550d12f", "fields": { "ebike": 3, "capacity": 20, "name": "Villiers de l'Isle Adam - Pyrénées", "nom_arrondissement_communes": "Paris", "numbikesavailable": 3, "is_installed": "OUI", "is_renting": "OUI", "mechanical": 0, "stationcode": "20111", "coordonnees_geo": [48.867362, 2.396222], "numdocksavailable": 17, "duedate": "2020-11-03T14:49:33+00:00", "is_returning": "OUI" }, "geometry": { "type": "Point", "coordinates": [2.396222, 48.867362] }, "record_timestamp": "2020-11-03T15:25:07.096000+00:00" }]

function createData(data) {

}





// Création de la map
class LeafLeatMap {

    constructor(init) {
            this.map = null
            this.bounds = []
            this.init = init
        }
        // Init de la map, utilisation d'openStreetMap
    async load(element) {
            return new Promise((resolve, reject) => {
                $script('https://unpkg.com/leaflet@1.7.1/dist/leaflet.js', () => {
                    this.map = L.map(element).setView(this.init, 11)
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                        zoom: 1
                    }).addTo(this.map)
                    resolve()
                })
            })

        }
        // Ajout de station sur la map, appel de la classe leafLetMarker
    addMarker(point, txt, id, className) {
            this.bounds.push(point)
            return new leafLetMarker(point, txt, this.map, id, className)
        }
        // Centrage de la map sur les marqueurs ajoutées
    center() {
        this.map.fitBounds(this.bounds)
    }
}






// Marqueurs leafLeft
class leafLetMarker {
    constructor(point, txt, map, id, className) {

            var popup = L.popup({
                    autoClose: false,
                    closeOnEscapeKey: false,
                    closeOnClick: false,
                    className: className,
                    maxWidth: 400
                })
                .setLatLng(point)
                .setContent(txt)
                .openOn(map)

        }
        // Fonction d'activation de la popup en cas de mouseover
    setActive() {
            this.popup.getElement().classList.add('is-active')
        }
        // Repasser la popup en mode normal aprés le mouseover
    unsetActive() {
        this.popup.getElement().classList.remove('is-active')
    }
    addEventListener(event, cv) {
        this.popup.addEventListener('add', () => {
            this.popup.getElement().addEventListener(event, cb)
        })
    }
    setContent(text) {
        this.popup.setContent(text)
        this.popup.update()
    }
}
// fct d'initialisation de la map
const initMap = async function(point) {
    let hoverMarker = null
    map = new LeafLeatMap(point); // Création variable map
    await map.load($map) // Chargement de la map depuis openstreetmap sur la var map

    //console.log(data)


    //console.log(station)
    //let stations = Array.from(document.querySelectorAll('.markers'))
    /*
    console.log('Stations : ')
    console.log(stations)
    //stations.forEach((item) => {
    item.addEventListener('mouseover',function(event){
        if(hoverMarker != null){
            hoverMarker.unsetActive();
        }
        item.setActive()
        hoverMarker = item
    })
     */
    //})

}

// Fcts de créations de popups en fct des données
function importMarkers(data) {
    $('.leaflet-popup-pane').empty(); //reset des popups
    dataVelib = data.station_velib
        //console.log('Velibs : ')
        //console.log(dataVelib[0])
    dataMonum = data.monuments
        //console.log('Monums : ')
        //console.log(dataMonum[0])

    dataVelib.forEach((item) => {
        //console.log(item.fields.name)
        let station = map.addMarker(item.coordonnees_geo,
            item.name,
            item.stationcode,
            'markersStation')
    })

    dataMonum.forEach((item) => {
        //console.log(item.attributes.type_archi.concat(item.attributes.immeuble))
        var coord = item.geometry.rings[0][0] // à definir
        coords = [coord[1],coord[0]]
        //console.log(coords)
        let station = map.addMarker(coords,
            item.attributes.type_archi.concat(item.attributes.immeuble),
            item.attributes.stationcode,
            'MarkersMonum')
    })
    map.center() // Centrage de la map sur les points créés
}
// Si map non existante, lancement de la map