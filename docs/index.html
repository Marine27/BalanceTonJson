<!DOCTYPE html>
<html lang="fr">

<head>

    <link rel="stylesheet" href="css/style.css">
    <meta charset="UTF-8">

    <title> BalanceTonJson </title>

    <!-- Library dependancy -->
    <!--    -->
</head>

<body>
    <div class="grid-container">
        <div class="terminal">
            <div class="headterminal"></div>
            <div class="areaterminal"></div>
        </div>
        <div class="files">
            <div class="headfiles"></div>
            <div class="choosefiles"></div>
            <div class="areafiles"></div>
        </div>
        <div class="desktop">
            <a><img class="icon" src="media/firefox.png" title="rayon" onclick="displayDiv(this.title)"></a><br>
            <a><img class="icon" src="media/appstore.png" title="custom-test" onclick="displayDiv(this.title)"></a><br>
            <a><img class="icon" src="media/thunderbird.png" title="send us a mail"></a><br>
            <a><img class="icon" src="media/git.png" title="Our git repository is public, check it"></a><br>
            <a><img class="icon" src="media/folder.png" title="API Documentation"></a><br>
            <a><img class="icon" src="media/json.png" title="JSON structure"></a><br>
            <a><img class="icon" src="media/rdf.png" title=" RDF structure "></a><br>
            <a><img class="icon" src="media/natoine.png" title="Minimum 15 <3 "></a><br>
            <a><img class="icon" src="media/terminal.png" title="Easter Egg"></a><br>
            <a><img id="appselector" class="icon" src="media/appselector.png" title="Back to normal"></a><br>







        </div>
        <div class="TOP"> Activité <span class="horloge" id="timeDisplay"></span> MIASHS-M2



        </div>
        <div class="blankarea">
            <div id="rayon">
                faudra mettre la la localisation + le rayon
            </div>
            <div id="custom-test"> TEST </div>
            <label for="address">Point de départ :</label>
            <input type='text' id='address' />
            <button onclick="valid_address()"> ok </button>
            <br>
            <br>
            <label for="radius">Rayon de recherche</label>
            <input type="range" class="custom-range" id="radius" min="1" max="50" value="1" />
            <small id="radius-val" class="form-text text-muted">Emprise de la zone sélectionnée</small>

        </div>

        <script type="text/javascript" src="js/utils.js"></script>
        <script type="text/javascript" src="js/geocoder.js"></script>
        <script>
            // default parameters
            let params = {
                lat: 48.8566969,
                long: 2.3514616,
                radius: 1000,
                minbike: 1,
                maxbike: 200,
                archi: 1000
            };
            console.log(params.lat, params.long, params.radius);

            //update the api
            function updateAPI() {
                let myHeaders = new Headers();
                myHeaders.append("Content-Type", "application/json");
                let url = (window.location.href == "http://localhost:3000/" ? "/" : "https://balance-ton-json.herokuapp.com/")
                url += 'locations?'
                url += 'lon=' + params.long + '&lat=' + params.lat
                url += '&radial=' + params.radius
                    //url += '&minbike='+ params.minbike + '&maxbike=' + params.maxbike 
                    //url += '&archi=' + params.archi
                fetch(url, {
                    method: 'get',
                    headers: myHeaders
                }).then(function(response) {
                    return response.json();
                }).then(function(data) {
                    console.log('data from api:', data);
                });
            }

            // convert address to gps coordinates
            function getCoords(address) {
                var openStreetMapGeocoder = GeocoderJS.createGeocoder('openstreetmap');
                openStreetMapGeocoder.geocode(address, function(result) {
                    params.lat = result[0].latitude;
                    params.long = result[0].longitude;
                });
            }

            // Address selection
            const iptAddress = document.getElementById("address");

            function valid_address() {
                iptAddress.setAttribute('value', 'Paris');
                getCoords(iptAddress.value);
                console.log("newval lat", params.lat, ", newval long", params.long);
                updateAPI();
            }

            // Radius selection
            const lblRadius = document.getElementById("radius-val");
            const iptRadius = document.getElementById("radius");
            iptRadius.addEventListener("input", () => {
                const radius = parseInt(document.getElementById("radius").value);
                lblRadius.innerHTML = radius === 0 ? "Emprise de la zone sélectionnée" : radius + "km autour du centre géométrique";
                params.radius = radius * 1000
                console.log("newval radius", radius);
                updateAPI();
            });
        </script>

    </div>
</body>

</html>